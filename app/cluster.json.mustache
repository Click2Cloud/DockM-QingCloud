{
  "name": {{cluster.name}},
  "description": {{cluster.description}},
  "vxnet": {{cluster.vxnet}},
  "nodes": [
    {
      "role": "master",
      "container": {
        "type": "kvm",
        "zone": "pek3a",
        "image": "img-6r23ionf"
      },
      "instance_class": {{cluster.master.instance_class}},
      "count": {{cluster.master.count}},
      "cpu": {{cluster.master.cpu}},
      "memory": {{cluster.master.memory}},
      "volume": {
        "size": {{cluster.master.volume_size}},
        "mount_point": "/data",
        "mount_options": "defaults,noatime",
        "filesystem": "ext4"
      },
      "services": {
        "init": {
          "cmd": "/opt/dockm/script/init-master.sh"
        },
        "start": {
          "cmd": "/opt/dockm/script/start-master.sh"
        },
        "stop": {
          "cmd": "pwd"
        },
        "destroy": {
          "nodes_to_execute_on": 1,
          "post_stop_service": true,
          "cmd": "/opt/dockm/script/destroy-master.sh"
        },
        "upgrade": {
          "cmd": "pwd",
          "post_start_service": true
        }
      },
      "custom_metadata": {
        "cmd": "pwd"
      },
      "health_check": {
        "enable": true,
        "interval_sec": 60,
        "timeout_sec": 10,
        "action_timeout_sec": 30,
        "healthy_threshold": 3,
        "unhealthy_threshold": 3,
        "check_cmd": "/opt/dockm/script/check-master.sh",
        "action_cmd": "/opt/dockm/script/restart-master.sh"
      },
      "monitor": {
        "enable": true,
        "cmd": "pwd",
        "items": {
          "docker_running_container_count": {
            "unit": "",
            "value_type": "int",
            "statistics_type": "latest",
            "scale_factor_when_display": 0.001
          },
          "docker_running_service_count": {
            "unit": "",
            "value_type": "int",
            "statistics_type": "latest",
            "scale_factor_when_display": 0.001
          }
        },
        "groups": {
          "docker": [
            "docker_running_service_count",
            "docker_running_container_count"
          ]
        },
        "display": [
          "docker"
        ],
        "alarm": [
          "docker_running_container_count"
        ]
      }
    },
    {
      "role": "node",
      "container": {
        "type": "kvm",
        "image": "img-6r23ionf",
        "zone": "pek3a"
      },
      "instance_class": {{cluster.node.instance_class}},
      "count": {{cluster.node.count}},
      "cpu": {{cluster.node.cpu}},
      "memory": {{cluster.node.memory}},
      "volume": {
        "size": {{cluster.node.volume_size}},
        "mount_point": "/data",
        "mount_options": "defaults,noatime",
        "filesystem": "ext4"
      },
      "vertical_scaling_policy": "sequential",
      "services": {
        "init": {
          "cmd": "/opt/dockm/script/init-node.sh"
        },
        "start": {
          "cmd": "/opt/dockm/script/start-node.sh"
        },
        "stop": {
          "order": 3,
          "cmd": "pwd"
        },
        "scale_in": {
          "nodes_to_execute_on": 1,
          "cmd": "pwd",
          "timeout": 86400
        },
        "destroy": {
          "nodes_to_execute_on": 1,
          "post_stop_service": false,
          "cmd": "/opt/dockm/script/destroy-node.sh"
        },
        "upgrade": {
          "cmd": "pwd"
        }
      },
      "health_check": {
        "enable": true,
        "interval_sec": 60,
        "timeout_sec": 10,
        "action_timeout_sec": 30,
        "healthy_threshold": 3,
        "unhealthy_threshold": 3,
        "check_cmd": "/opt/dockm/script/check-node.sh",
        "action_cmd": "/opt/dockm/script/restart-node.sh"
      },
      "monitor": {
        "enable": true,
        "cmd": "pwd",
        "items": {
          "docker_running_container_count": {
            "unit": "",
            "value_type": "int",
            "statistics_type": "latest",
            "scale_factor_when_display": 0.001
          },
          "docker_running_service_count": {
            "unit": "",
            "value_type": "int",
            "statistics_type": "latest",
            "scale_factor_when_display": 0.001
          }
        },
        "groups": {
          "docker": [
            "docker_running_service_count",
            "docker_running_container_count"
          ]
        },
        "display": [
          "docker"
        ],
        "alarm": [
          "docker_running_container_count"
        ]
      },
      "advanced_actions": [
        "scale_horizontal"
      ]
    }
  ],
  "env": {
    "access_key_id": {{env.access_key_id}},
    "secret_access_key": {{env.secret_access_key}}
  }
}